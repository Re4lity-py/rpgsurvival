<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Véritable Roulette Casino</title>
    <style>
        body { background-color: #1a1a1a; color: white; font-family: sans-serif; text-align: center; }
        .casino-container { margin-top: 30px; position: relative; display: inline-block; }
        
        /* Le Canvas pour la roue */
        #wheelCanvas { border: 10px solid #555; border-radius: 50%; box-shadow: 0 0 50px rgba(0,0,0,0.8); }

        /* Le curseur (flèche) */
        .arrow {
            position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent;
            border-top: 40px solid #D4AF37; z-index: 10;
        }

        .controls { background: #064E3B; padding: 20px; border-radius: 15px; margin-top: 20px; display: inline-block; border: 2px solid #D4AF37; }
        .btn { background: #D4AF37; border: none; padding: 15px 30px; font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 1.2rem; }
        .btn:disabled { background: #777; }
        input { padding: 10px; border-radius: 5px; border: none; width: 60px; text-align: center; font-weight: bold; }
        #resultat { font-size: 1.5rem; margin-top: 15px; color: #D4AF37; height: 40px; }
    </style>
</head>
<body>

    <h1>CASINO ROYALE</h1>

    <div class="casino-container">
        <div class="arrow"></div>
        <canvas id="wheelCanvas" width="400" height="400"></canvas>
    </div>

    <br>

    <div class="controls">
        <div style="margin-bottom: 10px;">Solde : <span id="balance">1000</span> $</div>
        Mise : <input type="number" id="bet" value="10"> | 
        Numéro : <input type="number" id="numTarget" value="7" min="0" max="36">
        <br><br>
        <button class="btn" id="spinBtn" onclick="lancerRoulette()">FAITES VOS JEUX !</button>
        <div id="resultat"></div>
    </div>

    <script>
        const canvas = document.getElementById("wheelCanvas");
        const ctx = canvas.getContext("2d");
        const numbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const colors = numbers.map((n, i) => n === 0 ? "#008000" : (i % 2 === 0 ? "#000000" : "#FF0000"));
        
        let angleActuel = 0;
        let balance = 1000;

        function dessinerRoue() {
            const rayon = canvas.width / 2;
            const angleTranche = (Math.PI * 2) / 37;

            for (let i = 0; i < 37; i++) {
                ctx.beginPath();
                ctx.fillStyle = colors[i];
                ctx.moveTo(rayon, rayon);
                ctx.arc(rayon, rayon, rayon, i * angleTranche, (i + 1) * angleTranche);
                ctx.fill();

                // Texte des numéros
                ctx.save();
                ctx.translate(rayon, rayon);
                ctx.rotate(i * angleTranche + angleTranche / 2);
                ctx.fillStyle = "white";
                ctx.font = "bold 14px Arial";
                ctx.fillText(numbers[i], rayon - 30, 5);
                ctx.restore();
            }
        }

        function lancerRoulette() {
            const bet = parseInt(document.getElementById('bet').value);
            const target = parseInt(document.getElementById('numTarget').value);
            if (bet > balance) return alert("Pas assez d'argent !");

            balance -= bet;
            document.getElementById('balance').innerText = balance;
            document.getElementById('spinBtn').disabled = true;
            document.getElementById('resultat').innerText = "La bille roule...";

            const tours = 5 + Math.random() * 5; // Entre 5 et 10 tours
            const duree = 5000; // 5 secondes
            const start = performance.now();
            const angleDepart = angleActuel;
            const rotationTotale = tours * Math.PI * 2;

            function animer(time) {
                let progression = (time - start) / duree;
                if (progression > 1) progression = 1;

                // Ralentissement progressif (Ease Out)
                let ease = 1 - Math.pow(1 - progression, 3);
                angleActuel = angleDepart + (rotationTotale * ease);

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.translate(canvas.width/2, canvas.height/2);
                ctx.rotate(angleActuel);
                ctx.translate(-canvas.width/2, -canvas.height/2);
                dessinerRoue();
                ctx.restore();

                if (progression < 1) {
                    requestAnimationFrame(animer);
                } else {
                    finaliserTour(target, bet);
                }
            }
            requestAnimationFrame(animer);
        }

        function finaliserTour(target, bet) {
            // Calcul du numéro gagnant sous la flèche (en haut, soit -90 degrés)
            const angleFinal = (angleActuel % (Math.PI * 2));
            const angleTranche = (Math.PI * 2) / 37;
            
            // On ajuste pour que la flèche pointe le haut (3*PI/2)
            let indexGagnant = Math.floor(( (Math.PI * 1.5) - angleFinal ) / angleTranche) % 37;
            if (indexGagnant < 0) indexGagnant += 37;

            const numGagnant = numbers[indexGagnant];
            const gagne = (numGagnant === target);

            if (gagne) {
                balance += bet * 36;
                document.getElementById('resultat').innerHTML = `<span style="color:#4ade80">JACKPOT ! Le ${numGagnant}</span>`;
            } else {
                document.getElementById('resultat').innerHTML = `Le ${numGagnant} est sorti.`;
            }

            document.getElementById('balance').innerText = balance;
            document.getElementById('spinBtn').disabled = false;
        }

        dessinerRoue();
    </script>
</body>
</html>